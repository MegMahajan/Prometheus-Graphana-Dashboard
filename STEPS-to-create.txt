Step 5 – Create IAM Service Account with Role

eksctl create iamserviceaccount --name ebs-csi-controller-sa --namespace kube-system --cluster eks2 --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy --approve --role-only --role-name AmazonEKS_EBS_CSI_DriverRole --region us-east-1

Step 5.1 – Attach Role to EKS Cluster

eksctl create addon --name aws-ebs-csi-driver --cluster eks2 --service-account-role-arn arn:aws:iam::164297528770:role/AmazonEKS_EBS_CSI_DriverRole --force --region us-east-1
Step 5.2 – Verify EBS CSI Driver Pods

kubectl get pods -n prometheus

Step 6 – Forward Prometheus Dashboard Ports

kubectl port-forward deployment/prometheus-server 9090:9090 -n prometheus

Step 6.1 – Open Prometheus Dashboard in Browser

curl localhost:9090/graph

Step 7 – Install Grafana

helm repo add grafana https://grafana.github.io/helm-charts
helm repo update

kubectl create namespace grafana
helm install grafana grafana/grafana --namespace grafana --set persistence.storageClassName="gp2" --set persistence.enabled=true --set adminPassword='EKS!sAWSome' --set service.type=LoadBalancer

Step 11.1 – Verify Grafana Installation

kubectl get pods -n grafana
kubectl get service -n grafana

Step 11.2 – Open Grafana in Browser

kubectl get service -n grafana

# Copy the EXTERNAL-IP and paste it in the 

Step 11.3 – Add Prometheus as the Datasource to Grafana

Go to Grafana Dashboard -> Add the Datasource -> Select Prometheus

Step 11.4 – Configure the endpoints of Prometheus and Save

URL: http://prometheus-server.prometheus.svc.cluster.local

Step 11.5 – Import Grafana Dashboard from Grafana Labs

Go to left side -> Click on Dashboards -> Click on New -> Import

Load and select the source as Prometheus

Step 12 – Visualize the Java Application

Step 13 – Deploy a Java Application and Monitor it on Grafana

git clone https://github.com/praveen1994dec/kubernetes_java_deployment.git
cd kubernetes_java_deployment/Kubernetes/
kubectl apply -f shopfront-service.yaml
kubectl get deployment
kubectl get pods
kubectl logs shopfront-7868468c56-4r2kk-cshopfront

Step 14 – Clean Up EKS Cluster

eksctl delete cluster --name eks2 --region us-east-1

These steps should provide a comprehensive guide for setting up, monitoring, and visualizing your Java application on EKS using Prometheus and Grafana.
